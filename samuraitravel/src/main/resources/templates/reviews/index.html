<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <div th:replace="~{fragment :: meta}"></div>
  <div th:replace="~{fragment :: styles}"></div>
  <title>レビュー一覧</title>
</head>
<body>
  <div class="samuraitravel-wrapper">
    <div th:replace="~{fragment :: header}"></div>

    <main>
      <div class="container pt-4 pb-5 samuraitravel-container">
        <div class="row justify-content-center">
          <div class="col-xl-6 col-lg-7 col-md-9">

            <!-- パンくず -->
            <nav class="mb-4" style="--bs-breadcrumb-divider:'>';" aria-label="breadcrumb">
              <ol class="breadcrumb mb-0">
                <li class="breadcrumb-item"><a th:href="@{/}">ホーム</a></li>
                <li class="breadcrumb-item"><a th:href="@{/houses}">店舗一覧</a></li>
                <li class="breadcrumb-item">
                  <a th:href="@{/houses/{id}(id=${house.id})}" th:text="${house.name}">店舗名</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">レビュー一覧</li>
              </ol>
            </nav>

            <!-- 0件 -->
            <div th:if="${reviewsPage.totalElements == 0}">
              まだレビューはありません。
            </div>

            <!-- 一覧 -->
            <ul class="list-unstyled" th:if="${reviewsPage.totalElements > 0}">
              <li th:each="r : ${reviewsPage.content}" class="mb-3 pb-3 border-bottom">
                <!-- 星 -->
                <div>
                  <span th:utext="${'&#9733;'.repeat(r.rating)}"></span>
                  <span th:utext="${'&#9734;'.repeat(5 - r.rating)}"></span>
                </div>
                <!-- コメント -->
                <div class="mt-1" th:text="${r.comment}">コメント</div>
                <!-- 自分のレビューのみ編集/削除 -->
                <div class="mt-1"
                     sec:authorize="isAuthenticated()"
                     th:if="${#authentication.principal.user.id == r.user.id}">
                  <a th:href="@{/reviews/{id}/edit(id=${r.id})}">編集</a>
                  <form th:action="@{/reviews/{id}/delete(id=${r.id})}" method="post" style="display:inline">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button type="submit">削除</button>
                  </form>
                </div>
              </li>
            </ul>

            <!-- ページネーション -->
            <div th:if="${reviewsPage.totalPages > 1}" class="d-flex justify-content-center">
              <nav aria-label="レビュー一覧ページ">
                <ul class="pagination">
                  <li class="page-item">
                    <span th:if="${reviewsPage.first}" class="page-link disabled">前</span>
                    <a th:unless="${reviewsPage.first}"
                       th:href="@{/reviews/house/{hid}(hid=${house.id}, page=${reviewsPage.number - 1})}"
                       class="page-link samuraitravel-page-link">前</a>
                  </li>
                  <li th:each="i : ${#numbers.sequence(0, reviewsPage.totalPages - 1)}" class="page-item">
                    <span th:if="${i == reviewsPage.number}" class="page-link active samuraitravel-active" th:text="${i + 1}"></span>
                    <a th:unless="${i == reviewsPage.number}"
                       th:href="@{/reviews/house/{hid}(hid=${house.id}, page=${i})}"
                       class="page-link samuraitravel-page-link" th:text="${i + 1}"></a>
                  </li>
                  <li class="page-item">
                    <span th:if="${reviewsPage.last}" class="page-link disabled">次</span>
                    <a th:unless="${reviewsPage.last}"
                       th:href="@{/reviews/house/{hid}(hid=${house.id}, page=${reviewsPage.number + 1})}"
                       class="page-link samuraitravel-page-link">次</a>
                  </li>
                </ul>
              </nav>
            </div>

          </div>
        </div>
      </div>
    </main>

    <div th:replace="~{fragment :: footer}"></div>
  </div>

  <div th:replace="~{fragment :: scripts}"></div>
</body>
</html>
