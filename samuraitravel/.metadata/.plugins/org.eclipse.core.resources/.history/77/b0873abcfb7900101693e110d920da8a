package com.example.samuraitravel.service;

import java.util.Optional;

import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.stereotype.Service;

import com.example.samuraitravel.entity.Review;
import com.example.samuraitravel.repository.ReviewRepository;

@Service
public class ReviewService {

    private final ReviewRepository reviewRepository;
    public ReviewService(ReviewRepository reviewRepository) {
        this.reviewRepository = reviewRepository;
    }

    // 民宿ごとの先頭 n 件を取得（画面の「先頭数件表示」用）
    public Page<Review> getReviewsForHouse(Integer houseId, int page, int size) {
        return reviewRepository.findByHouseIdOrderByCreatedAtDesc(houseId, PageRequest.of(page, size));
    }

    // 自分のレビュー（最新1件）を取得
    public Optional<Review> getUserReviewForHouse(Integer houseId, Integer userId) {
        return reviewRepository.findFirstByHouseIdAndUserIdOrderByCreatedAtDesc(houseId, userId);
    }
}
